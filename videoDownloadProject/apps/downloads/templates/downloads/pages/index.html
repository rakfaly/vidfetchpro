{% extends "base.html" %}
{% block title %}
    VidFetch Pro â€” Dashboard
{% endblock title %}
{% block content %}
    <section class="space-y-6">
        <div class="card">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div>
                    <h1 class="text-2xl font-semibold">
                        Grab video, audio, and subtitles in one
                        flow
                    </h1>
                    <p class="text-sm text-slate-500 dark:text-slate-400">
                        Paste a URL, validate it, pick a format, and
                        download with live progress.
                    </p>
                </div>
                <span class="rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold text-emerald-700 dark:bg-emerald-500/20 dark:text-emerald-300">Unlimited
                for logged users</span>
            </div>
            <!--Fetch Video Metadata -->
            <form method="post"
                  class="mt-6 space-y-4"
                  hx-post="{% url 'apps.downloads:fetch' %}"
                  hx-target="#fetched-metadata">
                {% csrf_token %}
                <label class="text-sm font-semibold text-slate-700 dark:text-slate-200">{{ fetch_form.video_url.label }}</label>
                <div class="flex flex-col gap-3 sm:flex-row">
                    {{ fetch_form.video_url }}
                    <div id="fetch-button-wrap" class="flex">{% include "downloads/partials/fetch/button.html" with task_status="" %}</div>
                </div>
                {% if fetch_form.video_url.errors %}
                    <p class="text-xs text-rose-500">{{ fetch_form.video_url.errors|striptags }}</p>
                {% endif %}
            </form>
        </div>
        <div id="fetched-metadata" class="space-y-6 justify-between gap-4">
            {% if restore_fetched %}
                {% include "downloads/partials/fetch/success.html" %}
            {% endif %}
        </div>
        <!-- Fetched formats -->
        <!-- Download -->
    </section>
    <aside class="space-y-6">
        <div class="card">
            <h2 class="text-lg font-semibold">User steps</h2>
            <ol class="mt-4 space-y-3 text-sm text-slate-600 dark:text-slate-300">
                <li class="step-card">1. Paste URL and click Fetch</li>
                <li class="step-card">2. Review metadata</li>
                <li class="step-card">3. Choose format</li>
                <li class="step-card">4. Download with live progress</li>
                <li class="step-card">5. View history (logged users)</li>
            </ol>
        </div>
        <div class="card" id="history-card">
            <div id="history-wrap"
                 hx-get="{% url 'apps.downloads:history' %}"
                 hx-target="#history-wrap"
                 hx-swap="innerHTML"
                 hx-trigger="load, refresh-history from:body">
                {% include "downloads/partials/history/list.html" %}
            </div>
            <div class="flex items-center justify-end">
                <span class="text-xs text-gray-400">
                    {% if history_list %}
                        <a href="{% url 'apps.history:history' %}" class="underline">See All</a>
                    {% endif %}
                </span>
            </div>
        </div>
    </aside>
{% endblock content %}
