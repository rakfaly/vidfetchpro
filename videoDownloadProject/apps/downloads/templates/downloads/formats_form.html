<div class="card ">
    <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold">Choose format</h2>
        <span class="text-xs text-slate-500">Step 3</span>
    </div>
    <div class="mt-4 grid gap-3">
        <form hx-target="#download-section"
              hx-post="{% url 'apps.downloads:prepare_download' %}"
              hx-trigger="load, change"
              hx-swap="outerHTML">
            {% csrf_token %}
            {% for fmt in formats %}
                <label class="flex items-center justify-between rounded-2xl border border-slate-200 p-4 text-sm hover:border-brand-500 dark:border-slate-800 {% if fmt.format_id|stringformat:'s' not in allowed_format_ids %}opacity-50 cursor-not-allowed{% endif %}">
                    <span>
                        <span class="block font-semibold">{{ fmt.ext }} Â·
                            {% if fmt.height %}{{ fmt.height }}p{% endif %}
                        </span>
                        <span class="block text-xs text-slate-500">
                            {% if fmt.height and fmt.height >= 720 %}
                                High quality video + audio ({{ fmt.filesize|filesizeformat }})
                            {% elif fmt.height and fmt.height >= 480 %}
                                Balanced size and quality ({{ fmt.filesize|filesizeformat }})
                            {% elif fmt.acodec != 'none' %}
                                Audio only (fastest) ({{ fmt.filesize|filesizeformat }})
                            {% else %}
                                Unknown format
                            {% endif %}
                        </span>
                    </span>
                    <div class="flex gap-2">
                        {% if fmt.format_id|stringformat:'s' not in allowed_format_ids %}
                            <a href="{% url 'pricing' %}"
                               class="block text-xs text-emerald-500 underline">Premium Member</a>
                        {% endif %}
                        <input type="radio"
                               name="format"
                               value="{{ fmt.format_id }}"
                               class="h-4 w-4 text-brand-500"
                               {% if fmt.format_id|stringformat:'s' == default_format_id %}checked{% endif %}
                               {% if fmt.format_id|stringformat:'s' not in allowed_format_ids %}disabled{% endif %} />
                    </div>
                </label>
            {% endfor %}
        </form>
    </div>
</div>
{% include "downloads/prepare_download.html" %}
