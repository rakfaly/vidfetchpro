<div class="card grid gap-4">
    <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold">Choose format</h2>
        <span class="text-xs text-slate-500">Step 3</span>
    </div>
    <div>
        <form hx-target="#download-section"
              hx-post="{% url 'apps.downloads:prepare_download' %}"
              hx-trigger="load, change"
              hx-swap="outerHTML">
            {% csrf_token %}
            <select name="format"
                    class="w-full rounded-2xl border border-slate-200 p-4 text-sm dark:border-slate-800">
                {% for fmt in formats %}
                    <option value="{{ fmt.format_id }}"
                            {% if fmt.format_id|stringformat:'s' == default_format_id %}selected{% endif %}
                            {% if fmt.format_id|stringformat:'s' not in allowed_format_ids %}disabled{% endif %}>
                        {{ fmt.ext|default:"bin" }} Â·
                        {% if fmt.height %}{{ fmt.height }}p{% else %}audio{% endif %}
                        -
                        {% if fmt.vcodec != 'none' and fmt.acodec != 'none' %}
                            Video + audio
                        {% elif fmt.vcodec != 'none' and fmt.acodec == 'none' %}
                            Video only (audio auto-merged)
                        {% elif fmt.acodec != 'none' %}
                            Audio only
                        {% else %}
                            Unknown format
                        {% endif %}
                        {% if fmt.filesize %} ({{ fmt.filesize|filesizeformat }}){% endif %}
                        {% if fmt.format_id|stringformat:'s' not in allowed_format_ids %} [Plan limit]{% endif %}
                    </option>
                {% endfor %}
            </select>
        </form>
    </div>
</div>
{% include "downloads/partials/download/prepare_section.html" %}
